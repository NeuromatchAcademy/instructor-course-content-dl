# Jupyterbook Support

We use [jupyterbook](https://jupyterbook.org/intro.html) to create a condensed, single interface to all our course materials. This book will be autogenerated and published to [https://neuromatchacademy.github.io/course-content-dl] every time a pull request is merged into the main branch.

The Github workflow is defined in `.github/workflows/publish-book.yaml`. 

In order to build the book locally, you will need to do the following:

1. Clone instructor-course-content-dl repo

`git clone https://github.com/NeuromatchAcademy/instructor-course-content-dl.git --depth=1`

2. Download nmaci repo (main branch)

`wget https://github.com/NeuromatchAcademy/nmaci/archive/refs/heads/main.tar.gz`

`tar -xzf main.tar.gz; rm -rf main.tar.gz`

3. Download course-content-dl repo (main branch) and copy files

`wget https://github.com/NeuromatchAcademy/course-content-dl/archive/refs/heads/main.tar.gz`

`tar -xzf main.tar.gz; rm -rf main.tar.gz`

4. Download precourse repo (main branch)

`wget https://github.com/NeuromatchAcademy/precourse/archive/refs/heads/main.tar.gz`

`tar -xzf main.tar.gz; rm -rf main.tar.gz`

5. Install dependencies

`cd instructor-course-content-dl`

`pip install -r ../nmaci-main/requirements.txt`

`pip install jupyter-book==0.10.2`

**Important:** Do not install jupyter-book 0.11 or later at this point, as there are breaking changes in how it handles the table of contents file we generate.

6. Copy files from course-content-dl-main and precourse-main

`mv ../course-content-dl-main/tutorials/ tutorials/`

`mv ../course-content-dl-main/projects/ projects/`

`mv ../course-content-dl-main/requirements.txt .`

`mv ../precourse-main/prereqs .`

`rm -r ../course-content-dl-main; rm -r ../precourse-main`

7. Create a symlink in the book dir to the tutorials dir. From the repo (i.e., course-content) root directory:

`ln -s ../tutorials book/tutorials`

`ln -s ../projects book/projects`

`ln -s ../prereqs book/prereqs`

8. Prepare repo for book building

`python ../nmaci-main/scripts/generate_book_dl.py instructor`

This will use the modified tutorials/materials.yml to create the `_toc.yml` file in the book directory. It will also be responsible for creating any additional markdown files or modifying any tutorial notebooks specifically for book generation. 

**No changes created by this script should be committed to the repo.**

9. Build the book

`jupyter-book build book`

This will create a `book/_build` directory. You can open the `index.html` in any browser to verify the book.
